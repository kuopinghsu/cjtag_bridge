# :electric_plug: Compact-JTAG to 4-Wire JTAG Bridge

[![license](https://img.shields.io/github/license/stnolting/cjtag_bridge)](https://github.com/stnolting/cjtag_bridge/blob/main/LICENSE)

* [Top Entity](#Top-Entity)
* [Simulation](#Simulation)
* [Hardware Utilization](#Hardware-Utilization)
* [Resources](#Resources)

This bridge implements a simple converter to connect _compact JTAG_ (cJTAG) probes to IEEE 1149.1 4-wire JTAG device.
cJTAG only uses two wires: a uni-directional clock generated by the probe (TCKC) and a bi-directional data signal (TMSC).

:information_source: This bridge only supports the **OScan1** cJTAG format yet.

:warning: **This project is still _work-in-progress_**.

Origianl VHDL code from [cjtag_bridge](https://github.com/stnolting/cjtag_bridg), convert it to Verilog file,
and using [Veriltor](https://github.com/verilator/verilator) for simulation.

## Top Entity

The top entity is [`rtl/cjtag_bridge.vhd`](https://github.com/stnolting/cjtag_bridge/blob/main/rtl/cjtag_bridge.vhd):

```verilog
module cjtag_bridge (
    // global control
    input       clk_i,       // main clock
    input       rstn_i,      // main reset, async, low-active

    // cJTAG (from debug probe)
    input       tckc_i,      // tap clock
    input       tmsc_i,      // tap data input
    output      tmsc_o,      // tap data output
    output      tmsc_oe_o,   // tap data output enable (tri-state driver)

    // JTAG (to device)
    output      tck_o,       // tap clock
    output      tdi_o,       // tap data input
    input       tdo_i,       // tap data input
    output      tms_o,       // tap mode select

    // Debugging (for testing only)
    output      db_tck_rising_o,
    output      db_tck_falling_o
);
```

:information_source: The cJTAG clock frequency (TCKC signal) must not exceed 1/5 of the main clock (`clk_i` signal) frequency.

:information_source: All 4-wire JTAG signals are expected to be sync to `clk_i` (same clock domain).

:information_source: The debug signals `db_*` are intended for testing/development only.


### Hardware Requirements

The bridge requires a module-external tri-state driver for the off-chip TMSC signal (`tmsc`), which handles the module's
`tmsc_i`, `tmsc_o` and `tmsc_oe_o` signals:

:warning: Better add a "panic resistor" into the bi-directional TMSC line - just to be safe.


## Simulation

The projects provides a very simple testbench to test the basic IO functions
([`sim/cjtag_bridge_tb.v`](sim/cjtag_bridge_tb.v)).
It can be simulated by Verilator via the Makefile

```
cjtag_bridge/sim$ make
```

The simulation will run for 1ms using a 100MHz clock. The waveform data is stored to `sim/wave.fst`
so it can be viewed using _gtkwave_:

```
cjtag_bridge/sim$ gtkwave wave.fst
```

## Hardware Utilization

:construction: TODO :construction:


## Resources

* [MIPS® cJTAG Adapter User’s Manual](https://s3-eu-west-1.amazonaws.com/downloads-mips/mips-documentation/login-required/mips_cjtag_adapter_users_manual.pdf)
* [https://sudonull.com/post/106128-We-disassemble-the-2-wire-JTAG-protocol](https://sudonull.com/post/106128-We-disassemble-the-2-wire-JTAG-protocol)
* [https://wiki.segger.com/J-Link_cJTAG_specifics](https://wiki.segger.com/J-Link_cJTAG_specifics)

